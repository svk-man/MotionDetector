# Проект "Крысы, мыши": Детектор движения (MotionDetector) крыс и мышей

## main.py - Консольная утилита для разметки видео

**Основные требования**

* Python 3.7+
* Библиотека для Python: [OpenCV](https://github.com/skvark/opencv-python)

### Установка и запуск на Windows ###

#### 1 Загрузка mark.py ####

**Лёгкий путь**

Загружаем [текстовую версию из репозитория](https://raw.githubusercontent.com/svk-man/MotionDetector/master/mark.py) и сохраняем в файл с расширением "py".

**Средний путь**

#### 1.1 Загружаем и устанавливаем последнюю версию [git](https://git-scm.com/download/) для Windows [необязательный шаг] ####

**Требования**

* Зарегистрированный [github-аккаунт](https://github.com)

![GitHub Download](/images/readme/git.png)

Подробнее [здесь](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%A3%D1%81%D1%82%D0%B0%D0%BD%D0%BE%D0%B2%D0%BA%D0%B0-Git).

Если установка проводится впервые:

* Производим [первоначальную настройку](https://git-scm.com/book/ru/v2/%D0%92%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5-%D0%9F%D0%B5%D1%80%D0%B2%D0%BE%D0%BD%D0%B0%D1%87%D0%B0%D0%BB%D1%8C%D0%BD%D0%B0%D1%8F-%D0%BD%D0%B0%D1%81%D1%82%D1%80%D0%BE%D0%B9%D0%BA%D0%B0-Git).

#### 1.2 Клонируем репозиторий [необязательный шаг] ####

Подробнее [здесь](https://git-scm.com/book/ru/v2/%D0%9E%D1%81%D0%BD%D0%BE%D0%B2%D1%8B-Git-%D0%A1%D0%BE%D0%B7%D0%B4%D0%B0%D0%BD%D0%B8%D0%B5-Git-%D1%80%D0%B5%D0%BF%D0%BE%D0%B7%D0%B8%D1%82%D0%BE%D1%80%D0%B8%D1%8F).

```
> git clone https://github.com/svk-man/MotionDetector.git
```

#### 2 Загружаем и устанавливаем последнюю версию [python](https://www.python.org/downloads/) для Windows ####

![Python Download](/images/readme/python.png)

#### 3 Загружаем библиотеки python для работы с утилитой ####

 * (OpenCV)[https://pypi.org/project/opencv-python/]
```
> pip install opencv-python
```

#### 4 Работаем с утилитой ####

Утилита позволяет на очередном кадре видео выделить прямоугольником крысу/мышь. Результат её работы: размеченные изображения и csv-файл с параметрами прямоугольников, отрисованных на изображениях.

**Входные параметры командной строки**

1. путь до видео;
2. использовать каждый N-ый кадр, то есть параметр - целое число N (например, N = 5, это значит, что обрабатывать нужно каждый 5-ый кадр, а 4 пропускать. По умолчанию N = 10.

Пример вызова:

```
> python mark.py "video/clip1.avi" 10
```

**Результат работы утилиты**

На выходе папка с именем как у видео файла, но без расширения (clip1), в папке два элемента:

1. папка с размеченными кадрами в виде картинок, например:

```
images
├── image1.jpg
├── image2.jpg
...
└── imageM.jpg
```

2. CSV-файл с разметкой, разделитель - запятая, заголовок: ```image_id,x,y,w,h,x+w,y+h```, где:

* image_id - имя изображения, включая внешнюю папку ("images/image1.jpg);
* x - левая X координата прямоугольника, начало координат в левом верхнем углу изображения (по-умолчанию в OpenCV);
* y - верхняя Y координата прямоугольника;
* w - ширина прямоугольника;
* h - высота прямоугольника;
* x+w - правая X координата прямоугольника;
* y+h - нижняя Y координата прямоугольника.

**Возможности**

1. Рисование прямоугольника. Нажатие левой кнопкой мыши создает точку (одну из вершин будущего прямоугольника), не отпуская левую кнопку мыши ведем в противоположный угол, когда левая кнопка мыши отпускается - прямоугольник создан.
2. Перетаскивание прямоугольника. Если прямоугольник существует и клик происходит внутри него - то при зажатой кнопке мыши он перетаскивается.
3. Отмена прямоугольника - при нажатии кнопки ESC прямоугольник отменяется
4. Переход к следующему кадру - кнопка пробел, на всех, кроме первого кадра отрисовывается прямоугольник с предыдущего, чтобы его можно было чуть подвинуть согласно пункту 2 на новое место крысы/мыши, тк ее размер скорее всего не изменится.
